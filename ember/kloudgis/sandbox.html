<html>
  <head>
	<meta name="apple-mobile-web-app-capable" content="no" />
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="description" content="">
	<meta name="author" content="Kloudgis.org">
	<link rel="shortcut icon" href="favicon.ico">
	<link rel="apple-touch-icon" href="apple-touch-icon.png">
	<link rel="stylesheet" href="css/style.css" type="text/css" media="screen"/>
	<link rel="stylesheet" href="css/switch.css" type="text/css" media="screen"/>
	<link rel="stylesheet" href="css/common.css" type="text/css" media="screen"/>
	<link rel="stylesheet" href="ext/leaflet/leaflet.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="assets/sandbox_styles.css" type="text/css" media="screen"/>
    <title>Kloudgis</title>
  </head>
  <body>	
	<div id="box">			
		<!-- *** MAP *** -->
		<div id="super-map">
			<div id="map">		
			</div>	
			<span id="back-home" class="kg-controls clickable">
				<a href="home.html"></a>
			</span>
			<script type="text/x-handlebars">
						{{#view KG.Button id="palette-button" tagName="div" titleBinding="KG.paletteController.createLabel" class="kg-controls clickable unselectable"  sc_action="showPaletteAction" isVisibleBinding="KG.paletteController.isAvailable"}}
							<img src="resources/images/palette.png"/>
						{{/view}}
			</script>
			<script type="text/x-handlebars">
					{{#view KG.Button id="note-button" tagName="div" titleBinding="KG.activeNoteController.createLabel" class="kg-controls clickable unselectable"  sc_action="createNoteAction"}}
						<img src="resources/images/note.png"/>
					{{/view}}
			</script>
			<span id="active-sandbox-label">	
				<span class="label-ellipsis"></span>
			</span>
			<!-- Notifications icon in the top area -->
			<script type="text/x-handlebars">
				{{#view id="notification-panel"}}
					{{#view KG.NotificationButtonView id="notification-button" class="kg-controls clickable unselectable" tagName="span" sc_action="toggleNotificationPopupAction" classBinding="KG.notificationsController.activePopup"}}
						{{#view class="capsule-label" isVisibleBinding="KG.notificationsController.hasNotification"}}
							{{parentView.notificationCount}}
						{{/view}}
						<img {{bindAttr src="notificationImg"}}/>
					{{/view}}			
				{{/view}}
			</script>
			
			<div id="super-notification-popup">
					<script type="text/x-handlebars">
					{{#view id="notification-popup" isVisibleBinding="KG.notificationsController.activePopup"}}
						{{#view id="notification-label"}}
							{{loc _notificationTitle}}
						{{/view}}
						<div>
						{{#view KG.Button id="notification-send-button" tagName="span" class="white-button unselectable" classBinding="KG.notificationsController.hasNotification" sc_action="sendTextNotificationAction"}}
							{{loc _notificationSendText}}
						{{/view}}
						{{#view KG.Button id="notification-clear-button" tagName="span" class="red-button unselectable" 
						 isVisibleBinding="KG.notificationsController.hasNotification" sc_action="clearNotificationAction"}}
							{{loc _notificationClear}}
						{{/view}}						
						</div>
						{{#collection contentBinding="KG.notificationsController.content"}}					
							{{#view KG.NotificationView class="notification-item"}}
								{{#view class="notification-item-title"}}
									<a {{bindAttr href="parentView.authorMailTo"}}> {{parentView.authorValue}}</a>{{parentView.titleValue}}{{parentView.dateValue}}
								{{/view}}
								{{#view class="notification-item-message"}}
									<!-- triple brakets to unescape HTML -->
									{{{parentView.messageValue}}}
								{{/view}}
							{{/view}}
							{{/collection}}
					{{/view}}
					</script>
			</div>
			
			<!-- Bookmark icon in the top area -->
			<script type="text/x-handlebars">
				{{#view id="bookmark-panel" class="unselectable"}}
					{{#view KG.BookmarkButtonView id="bookmark-button" class="kg-controls clickable unselectable" tagName="span" sc_action="toggleBookmarkPopupAction" classBinding="KG.bookmarksController.activePopup"}}
						<img {{bindAttr src="bookmarkImg"}}/>
					{{/view}}				
				{{/view}}
			</script>			
			<div id="super-bookmark-popup">
				<script type="text/x-handlebars">
					{{#view id="bookmark-popup" isVisibleBinding="KG.bookmarksController.activePopup"}}						
						<div id="bookmark-top-bar">
							{{loc _bookmarkTitle id="bookmark-label" tagName="div"}}
							{{#view KG.Button id="bookmark-add-button" tagName="span" class="white-button unselectable" sc_action="addBookmarkAction"}}
								{{loc _bookmarkAdd}}
							{{/view}}
							{{#view KG.EditBookmarkButtonView id="bookmark-edit-button" tagName="span" class="white-button unselectable" sc_action="editBookmarkAction"}}
								{{loc _bookmarkEdit}}
							{{/view}}											
						</div>
						{{#collection id="bookmark-list" contentBinding="KG.bookmarksController.content" tagName="table" itemViewClass="KG.BookmarkItemView" classBinding="KG.bookmarksController.editMode"}}	
								{{#view KG.Button class="bookmark-item-label" tagName="td" sc_action="selectBookmarkAction"}}
									{{itemView.content.label}}
								{{/view}}								
								{{#view KG.Button class="bookmark-item-author" tagName="td" sc_action="selectBookmarkAction"}}
									{{itemView.content.user_descriptor}}
								{{/view}}
								{{#view KG.Button class="bookmark-item-date" tagName="td" sc_action="selectBookmarkAction"}}
									{{itemView.content.formattedDate}}
								{{/view}}
								{{#view tagName="td" isVisibleBinding="KG.bookmarksController.editMode"}}
									{{#view KG.BookmarkDeleteButtonView class="bookmark-delete red-button unselectable" sc_action="deleteBookmarkAction"}}
										-
									{{/view}}
								{{/view}}
						{{/collection}}
					{{/view}}
				</script>
			</div>
			
			<!-- search control in the bottom area -->
			<script type="text/x-handlebars">			
				{{#view class="kg-controls" id="search-control" tagName="span" classBinding="KG.searchController.hasResults"}}
					{{#view KG.SearchField resultsBinding="KG.searchController.searchHistorySize" placeholder_not_loc="_search" valueBinding="KG.searchController.searchValue"}}
					{{/view}}
					{{#collection contentBinding="KG.searchController" isVisibleBinding="KG.searchController.hasResults" tagName="ul" class="search-cat-list no-style-list"}}
						{{#view KG.Button class="search-cat-item" tagName="div" sc_action="selectSearchCategoryAction"}}
							<table class="search-category-table">
							<tr>
							<td>
							{{#view class="cat-title-label label-ellipsis" titleBinding="itemView.content.title"}}
								{{itemView.content.title}}
							{{/view}}
							</td>
							<td>
							{{#view class="cat-size-label label-ellipsis capsule-label" tagName="span"}}
								{{itemView.content.count}}
							{{/view}}
							</td>
							</tr>
							</table>
						{{/view}}
					{{/collection}}
					{{#collection contentBinding="KG.core_search.plugins" isVisibleBinding="KG.core_search.searchAsked" tagName="ul" class="search-cat-list no-style-list"}}
						{{#view KG.Button class="search-plugin-item" tagName="div" sc_action="selectSearchPluginAction"}}
							{{#view class="plugin-title-label label-ellipsis" titleBinding="itemView.content.title"}}
								{{itemView.content.title}}
							{{/view}}
						{{/view}}
					{{/collection}}
				{{/view}}
			</script>
			<script type="text/x-handlebars">
				{{#view class="kg-controls" id="position-label" tagName="span"}}
					<span>{{KG.core_sandbox.latitudeLabel}}</span>
					<span>{{KG.core_sandbox.longitudeLabel}}</span>
					{{/view}}
			</script>
		</div>
	</div>	

	<!-- search results in the middle of the screen -->
	<script type="text/x-handlebars">
		{{#view id="search-result" classBinding="KG.searchResultsController.listVisible"}}
		{{#view class="search-title-area" }}
			{{#view KG.Button class="x-button search-close-button"  sc_action="hideSearchResultAction" titleBinding="KG.searchResultsController.closeLabel"}}
			{{/view}}
			<div id="title-label">
				{{KG.searchResultsController.listTitle}}
			</div>
		{{/view}}
		{{#view class="search-list-area" classBinding="KG.searchResultsController.hasResults"}}
			{{#collection contentBinding="KG.searchResultsController" class="search-result-list"}}
				{{#view KG.Button class="search-list-item" tagName="div"}}
					<table class="search-result-table">
					<tr>
						<td class="search-title-cell">
							{{#view KG.SearchResultLabelView class="feature-title-label"}}
								{{itemView.content.title}}
							{{/view}}
						</td>
						<td class="search-select-cell">
							{{#view KG.Button isVisibleBinding="itemView.content.isSelectable" class="search-select" tagName="div"  sc_action="selectFeatureInspectorAction"}}	
								<img src="resources/images/right_arrow_32.png"/>		
							{{/view}}
						</td>
						<td class="search-select-cell">
							{{#view KG.Button isVisibleBinding="itemView.content.hasCreateNote" class="search-create-note" tagName="div"  sc_action="createNoteFromFeatureAction"}}	
								<img src="resources/images/note.png"/>		
							{{/view}}
						</td>
					</tr>
					</table
				{{/view}}
			{{/collection}}
		{{/view}}
		{{/view}}
	</script>
  </body>

<!-- load all of the dependencies --> 
   <script type="text/javascript" src="assets/bpm_libs.js" ></script>
   <script type="text/javascript" src="assets/templates_lib.js" ></script>
   <script type="text/javascript" src="assets/app_lib.js" ></script> 
   <script type="text/javascript" src="assets/auth_lib.js" ></script>
   <script type="text/javascript" src="assets/core_lib.js" ></script>
   <script type="text/javascript" src="assets/map_lib.js" ></script>
   <script type="text/javascript" src="assets/sandbox_lib.js" ></script>
<!-- load my app external lib --> 
   <script type="text/javascript" src="ext/leaflet/leaflet.js" ></script> 
   <script type="text/javascript" src="ext/plugins/autoresize.jquery.js" ></script> 
   <script type="text/javascript" src="ext/plugins/jquery.atmosphere.js" ></script> 
   <script type="text/javascript"> 
	      spade.ready(function() { 
			//bootstrap
	        spade.require('kloudgis/sandbox/lib/main');			
	      }); 
   </script>
	
</html>
